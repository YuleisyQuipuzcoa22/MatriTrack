<div class="fondo d-flex justify-content-center align-items-center min-vh-100">
  <div class="card-container">
    <div class="header text-center">
      <h2 class="titulo">{{ isEditMode ? 'EDITAR CONTROL' : 'NUEVO CONTROL' }}</h2>
      <p class="subtitulo">Programa: {{ programaId }}</p>
      @if(isEditMode && fechaCreacion){
        <p class="subtitulo">Fecha de Control: <strong>{{ fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</strong></p>
      }
    </div>

    @if (isLoading) {
      <div class="text-center p-5">
        <div class="spinner-border" role="status" style="color: #850e35;">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2">Cargando datos del control...</p>
      </div>
    }

    <form [formGroup]="controlForm" (ngSubmit)="guardar()" *ngIf="!isLoading">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="label">Peso (kg) <span class="text-danger">*</span></label>
          <input type="number" step="0.1" class="form-control" formControlName="peso" placeholder="Ej. 65.5" />
          @if (isInvalid('peso')) {
            <small class="text-danger">{{ getErrorMessage('peso') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Talla (m) <span class="text-danger">*</span></label>
          <input type="number" step="0.01" class="form-control" formControlName="talla" placeholder="Ej. 1.60" />
           @if (isInvalid('talla')) {
            <small class="text-danger">{{ getErrorMessage('talla') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Presión arterial <span class="text-danger">*</span></label>
          <input class="form-control" formControlName="presion_arterial" placeholder="Ej. 120/80" />
           @if (isInvalid('presion_arterial')) {
            <small class="text-danger">{{ getErrorMessage('presion_arterial') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Involución uterina</label>
          <input class="form-control" formControlName="involucion_uterina" />
           @if (isInvalid('involucion_uterina')) {
            <small class="text-danger">{{ getErrorMessage('involucion_uterina') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Cicatrización</label>
          <input class="form-control" formControlName="cicatrizacion" />
           @if (isInvalid('cicatrizacion')) {
            <small class="text-danger">{{ getErrorMessage('cicatrizacion') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Estado mamas / lactancia</label>
          <input class="form-control" formControlName="estado_mamas_lactancia" />
           @if (isInvalid('estado_mamas_lactancia')) {
            <small class="text-danger">{{ getErrorMessage('estado_mamas_lactancia') }}</small>
          }
        </div>

        <div class="col-md-6 mb-3">
          <label class="label">Estado emocional</label>
          <input class="form-control" formControlName="estado_emocional" />
           @if (isInvalid('estado_emocional')) {
            <small class="text-danger">{{ getErrorMessage('estado_emocional') }}</small>
          }
        </div>

        <div class="col-12 mb-3">
          <label class="label">Observación</label>
          <textarea class="form-control" formControlName="observacion"></textarea>
           @if (isInvalid('observacion')) {
            <small class="text-danger">{{ getErrorMessage('observacion') }}</small>
          }
        </div>

        <div class="col-12 mb-3">
          <label class="label">Recomendación</label>
          <textarea class="form-control" formControlName="recomendacion"></textarea>
           @if (isInvalid('recomendacion')) {
            <small class="text-danger">{{ getErrorMessage('recomendacion') }}</small>
          }
        </div>
      </div>

      @if (errorMessage) {
        <div class="alert alert-danger text-center mt-3">{{ errorMessage }}</div>
      }

      <div class="text-center mt-3">
        <button type="submit" class="btn-submit" [disabled]="isLoading">
          @if(isLoading) {
            <span class="spinner-border spinner-border-sm me-2"></span> Guardando...
          } @else {
            {{ isEditMode ? 'Guardar Cambios' : 'Crear Control' }}
          }
        </button>
        <button type="button" class="btn-volver ms-3" (click)="cancelar()" [disabled]="isLoading">← Volver</button>
      </div>
    </form>
  </div>
</div>