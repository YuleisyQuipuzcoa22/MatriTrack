<div class="fondo d-flex justify-content-center align-items-center min-vh-100">
  <div class="card-container-wide">
    <div class="header text-center">
      <h2 class="titulo">REGISTRO DE NUEVO PACIENTE</h2>
      <p class="subtitulo">Complete los datos personales y el historial médico inicial.</p>
      <!-- Placeholder para el logo -->
      <img src="https://yt3.googleusercontent.com/dSnqcXzoOXSJp35-I_9lPnUTa3M9qOuck07IS_UlvCz3lmBRQ8uohBfqb5GRzeOAdZjWKmeD=s900-c-k-c0x00ffffff-no-rj" alt="Logo" class="logo" />
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="formulario">
      <!-- SECCIÓN DE DATOS PERSONALES -->
      <h3 class="section-title mt-4 mb-3">1. Datos Personales</h3>
      <div class="row">
        <!-- FILA 1: DNI, Nombre, Apellido -->
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">DNI</label>
          <input
            type="text"
            formControlName="dni"
            class="form-control"
            placeholder="8 dígitos numéricos"
          />
          @if (registerForm.get('dni')?.invalid && registerForm.get('dni')?.touched) {
          <small class="text-danger">El DNI debe tener 8 dígitos numéricos.</small>
          }
        </div>

        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Nombre(s)</label>
          <input
            type="text"
            formControlName="nombre"
            class="form-control"
            placeholder="Nombre(s) del paciente"
          />
          @if (registerForm.get('nombre')?.invalid && registerForm.get('nombre')?.touched) {
          <small class="text-danger">El nombre es obligatorio.</small>
          }
        </div>
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Apellido(s)</label>
          <input
            type="text"
            formControlName="apellido"
            class="form-control"
            placeholder="Apellido(s) del paciente"
          />
          @if (registerForm.get('apellido')?.invalid && registerForm.get('apellido')?.touched) {
          <small class="text-danger">El apellido es obligatorio.</small>
          }
        </div>

        <!-- FILA 2: Fecha Nacimiento, Sexo, Teléfono -->
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Fecha de Nacimiento</label>
          <input type="date" formControlName="fecha_nacimiento" class="form-control" />
          @if (registerForm.get('fecha_nacimiento')?.invalid &&
          registerForm.get('fecha_nacimiento')?.touched) {
          <small class="text-danger">La fecha es obligatoria.</small>
          }
        </div>

        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Sexo</label>
          <select formControlName="sexo" class="form-select">
            <option value="" disabled>Seleccione</option>
            <option value="M">Masculino</option>
            <option value="F">Femenino</option>
          </select>
          @if (registerForm.get('sexo')?.invalid && registerForm.get('sexo')?.touched) {
          <small class="text-danger">El sexo es obligatorio.</small>
          }
        </div>

        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Teléfono</label>
          <input
            type="text"
            formControlName="telefono"
            class="form-control"
            placeholder="Teléfono de contacto"
          />
          @if (registerForm.get('telefono')?.invalid && registerForm.get('telefono')?.touched) {
          <small class="text-danger">Ingrese un número válido (9 a 15 caracteres).</small>
          }
        </div>

        <!-- FILA 3: Correo, Dirección -->
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Correo Electrónico</label>
          <input
            type="email"
            formControlName="correo_electronico"
            class="form-control"
            placeholder="email@ejemplo.com"
          />
          @if (registerForm.get('correo_electronico')?.invalid &&
          registerForm.get('correo_electronico')?.touched) {
          <small class="text-danger">Ingrese un correo válido.</small>
          }
        </div>

        <div class="col-lg-8 col-md-6 mb-3">
          <label class="label">Dirección</label>
          <input
            type="text"
            formControlName="direccion"
            class="form-control"
            placeholder="Dirección de residencia"
          />
          @if (registerForm.get('direccion')?.invalid && registerForm.get('direccion')?.touched) {
          <small class="text-danger">La dirección es obligatoria.</small>
          }
        </div>
      </div>

      <!-- SECCIÓN DE HISTORIAL MÉDICO -->
      <h3 class="section-title mt-4 mb-3">2. Historial Médico Inicial</h3>
      <!-- Formulario anidado para el historial_medico -->
      <div formGroupName="historial_medico" class="row">
        <!-- FILA 4: Tipo de Sangre -->
        <div class="col-lg-4 col-md-6 mb-3">
              <label class="label">Tipo de Sangre</label>
              <select formControlName="tipo_sangre" class="form-select">
                <option value="" disabled>Seleccione Tipo</option>
                @for (ts of tiposSangre; track ts) {
                <option [value]="ts">{{ ts }}</option>
                }
              </select>
              @if (registerForm.get('historial_medico.tipo_sangre')?.invalid && registerForm.get('historial_medico.tipo_sangre')?.touched) {
                <small class="text-danger">El tipo de sangre es obligatorio.</small>
              }
            </div>

        <!-- FILA 4: Antecedente Médico (Opcional) -->
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Antecedente Médico</label>
          <input
            type="text"
            formControlName="antecedente_medico"
            class="form-control"
            placeholder="Ej: Diabetes, Hipertensión, Cirugía previa..."
          />
        </div>

        <!-- FILA 4: Alergias (Opcional) -->
        <div class="col-lg-4 col-md-6 mb-3">
          <label class="label">Alergias</label>
          <input
            type="text"
            formControlName="alergia"
            class="form-control"
            placeholder="Ej: Penicilina, polen, alimentos..."
          />
        </div>
      </div>
      <!-- FIN SECCIÓN HISTORIAL MÉDICO -->

      <div class="text-center mt-4 button-group">
        <button type="submit" class="btn-submit" [disabled]="registerForm.invalid || isLoading">
          @if (isLoading) {
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Registrando... } @else { Registrar Paciente }
        </button>
        <!-- Puedes cambiar este enlace a la ruta que muestre el listado de pacientes -->
        <a routerLink="/pacientes" class="btn-volver">← Ir a Inicio</a>
      </div>

      @if (errorMessage) {
      <div class="alert alert-danger mt-3 text-center">{{ errorMessage }}</div>
      } @if (successMessage) {
      <div class="alert alert-success mt-3 text-center">{{ successMessage }}</div>
      }
    </form>
  </div>
</div>
