<div class="puerperio-root">
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h2>
            <i class="bi bi-folder2-open"></i>
            Resultados de Análisis
          </h2>
          
          @if(idControl){
            <h5 class="text-muted fw-normal mt-2">
              <i class="bi bi-person-circle me-1"></i>
              Paciente: <strong>{{ pacienteNombre }}</strong> | Control: <strong>{{ idControl }}</strong>
            </h5>
          }
          </div>
        <div class="col-md-4 text-end">
        <button class="btn btn-agregar" (click)="irARegistrar()">
            <i class="bi bi-plus-circle-fill me-2"></i>
            Agregar Nuevo Resultado
        </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">

  @if (isLoading) {
    <div class="text-center p-5">
      <div class="spinner-border" role="status" style="color: #850e35;">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando resultados...</p>
    </div>
  }
  @if (errorMessage) {
    <div class="alert alert-danger text-center">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
    </div>
  }
  
  <p class="results-info">
    <i class="bi bi-list-ul me-2"></i>
    {{ resultados.length }} resultados encontrados
  </p>

  @if (!isLoading && !errorMessage) {
    <div class="obstetras-grid">
      @for (res of resultados; track res.id_resultado_analisis) {
      <div class="obstetra-card tile-card">
        <div class="card-body-custom">
          <h6 class="obstetra-name">
            <i class="bi bi-folder2-open"></i>
            {{ res.analisis?.nombre_analisis || 'Análisis' }} 
            <span class="obstetra-id">#{{ res.id_resultado_analisis }}</span>
          </h6>

          <div class="info-item">
            <i class="bi bi-calendar-event"></i>
            <strong>F. Realización:</strong> 
            <span class="ms-2">{{ res.fecha_realizacion | date: 'dd/MM/yyyy' }}</span>
          </div>

          <div class="info-item">
            <i class="bi bi-calendar-check"></i>
            <strong>F. Registro:</strong> 
            <span class="ms-2">{{ res.fecha_registro | date: 'dd/MM/yyyy HH:mm' }}</span>
          </div>

          <div class="info-item">
            <i class="bi bi-building"></i>
            <strong>Laboratorio:</strong> 
            <span class="ms-2">{{ res.laboratorio }}</span>
          </div>
        </div>

        <div class="card-footer-custom">
          <div class="actions-group">
            <button class="btn-action-full btn-info-action" 
                    (click)="verDetalle(res.id_resultado_analisis)">
              <i class="bi bi-info-circle-fill me-2"></i>
              Ver Detalles
            </button>
            <button class="btn-action-full btn-edit-action" 
               (click)="editarResultado(res.id_resultado_analisis)">
              <i class="bi bi-pencil-square me-2"></i>
              Editar
            </button>
            <button class="btn-action-full btn-danger-action" 
               (click)="eliminarResultado(res.id_resultado_analisis)">
              <i class="bi bi-trash-fill me-2"></i>
              Eliminar
            </button>
          </div>
        </div>
      </div>
      } @empty {
      <div class="no-results">
        <i class="bi bi-file-earmark-slides"></i>
        <h4>0 resultados encontrados</h4>
        <p>No se encontraron resultados para este control.</p>
      </div>
      }
    </div>
  }
</div>